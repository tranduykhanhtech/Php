# Bảo mật website
RewriteEngine On

# Chuyển hướng HTTP sang HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Ẩn thông tin server
ServerTokens Prod
ServerSignature Off

# Bảo vệ file cấu hình
<Files "config/*">
    Order Deny,Allow
    Deny from all
</Files>

# Bảo vệ file .env
<Files ".env">
    Order Deny,Allow
    Deny from all
</Files>

# Bảo vệ file .htaccess
<Files ".htaccess">
    Order Deny,Allow
    Deny from all
</Files>

# Chặn truy cập thư mục
Options -Indexes

# Bảo mật headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' cdn.tailwindcss.com cdnjs.cloudflare.com cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' cdnjs.cloudflare.com;"
</IfModule>

# Giới hạn kích thước upload
php_value upload_max_filesize 5M
php_value post_max_size 10M
php_value max_execution_time 30
php_value max_input_time 30

# Tắt hiển thị lỗi PHP
php_flag display_errors Off
php_flag log_errors On

# Chặn truy cập file backup
<FilesMatch "\.(bak|backup|old|tmp)$">
    Order Deny,Allow
    Deny from all
</FilesMatch>

# Chặn truy cập file log
<FilesMatch "\.log$">
    Order Deny,Allow
    Deny from all
</FilesMatch>

# Chặn truy cập thư mục uploads trực tiếp (chỉ cho phép ảnh)
<Directory "uploads">
    <FilesMatch "\.(php|php3|php4|php5|phtml|pl|py|jsp|asp|sh|cgi)$">
        Order Deny,Allow
        Deny from all
    </FilesMatch>
</Directory>